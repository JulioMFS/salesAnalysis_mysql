<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
    .upload-hint {
        font-size: 0.6rem;
        font-style: italic;
        opacity: 0.75;
        text-align: center;
    }
    .upload-zone {
        border: 2px dashed #ced4da;
        border-radius: 0.5rem;
        padding: 1.2rem;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: 500;
        user-select: none;
    }
    .upload-bank {
        background: #0d6efd10;
        border-color: #0d6efd;
        color: #0d6efd;
    }
    .upload-bank:hover { background: #0d6efd30; }
    .upload-sales {
        background: #19875410;
        border-color: #198754;
        color: #198754;
    }
    .upload-sales:hover { background: #19875430; }
    .upload-zone.dragover {
        background: #212529 !important;
        color: #fff !important;
        border-color: #212529 !important;
    }
    .upload-btn {
        cursor: pointer;
        padding: 0.75rem 1rem;
        transition: all 0.2s ease;
        font-weight: 500;
        user-select: none;
    }
    .upload-tpa {
        background: #6c757d10;
        border-color: #6c757d;
        color: #6c757d;
    }
    .upload-tpa:hover {
        background: #6c757d30;
    }

    .upload-btn.dragover.btn-primary { background-color: #0b5ed7; color: #fff; }
    .upload-btn.dragover.btn-success { background-color: #157347; color: #fff; }
    </style>
</head>
<body>

<div class="container mt-5">
    <h1 class="mb-4">Dashboard</h1>

    <!-- Upload / Reconciliation Section -->
    {% include '_upload_section.html' %}

    <!-- Navigation Buttons (2 per row, equal size) -->
    <div class="row g-3 mb-4">
        <div class="col-md-6 d-flex">
            <a href="{{ url_for('expenses_vs_sales') }}" class="btn btn-info flex-fill py-2">
                Expenses vs Sales
            </a>
        </div>
        <div class="col-md-6 d-flex">
            <a href="{{ url_for('sales_vs_deposits') }}" class="btn btn-warning flex-fill py-2">
                Sales vs Bank Deposits
            </a>
        </div>
    </div>

    <!-- Flash Messages -->
    <div class="mt-3">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, msg in messages %}
                    <div class="alert alert-{{ 'success' if category=='success' else 'danger' }} py-1" role="alert" style="font-size:0.85rem;">
                        {{ msg }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <!-- Debit Classifications Manager -->
    {% include 'debit_classifications.html' %}

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='dashboard.js') }}"></script>
<script src="{{ url_for('static', filename='upload.js') }}"></script>
<script>
function validateBankFiles(input) {
    const files = Array.from(input.files);
    const validFiles = [];
    const invalidFiles = [];

    files.forEach(f => {
        if (/^CGD_Conta_Extracto.*\.csv$/i.test(f.name)) {
            validFiles.push(f);
        } else {
            invalidFiles.push(f.name);
        }
    });

    if (invalidFiles.length > 0) {
        alert(
            'Invalid files:\n' +
            invalidFiles.join('\n') +
            '\n\nOnly files starting with CGD_Conta_Extracto and ending with .csv are allowed.'
        );
        input.value = ''; // remove all selected files
    }
}
</script>
</body>
</html>

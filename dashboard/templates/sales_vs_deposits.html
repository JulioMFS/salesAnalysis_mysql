<!DOCTYPE html>
<html>
<head>
    <title>Sales vs Bank Deposits</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-size: 0.9rem; }
        table { font-size: 0.75rem; margin-bottom: 1rem; }
        th, td { padding: 0.2rem 0.3rem; vertical-align: middle; }
        .text-end { text-align: right; }
        .diff-negative { color: red; font-weight: bold; }
        .diff-positive { color: green; font-weight: bold; }
        .card-header { font-size: 0.9rem; padding: 0.35rem 0.75rem; }
        .btn-smaller { font-size: 0.8rem; padding: 0.25rem 0.5rem; }
        .bg-warning { background-color: #ffe066 !important; }
    </style>

</head>
<body class="container mt-4">

<!-- Back button -->
<a href="{{ url_for('dashboard') }}" class="btn btn-secondary btn-smaller mb-3">← Back to Dashboard</a>

<!-- Date selection form -->
<form method="get" class="row g-3 mb-4">
    <div class="col-auto">
        <label for="start_date" class="form-label">Start:</label>
        <input type="date" id="start_date" name="start_date" class="form-control" value="{{ start_date }}">
    </div>
    <div class="col-auto">
        <label for="end_date" class="form-label">End:</label>
        <input type="date" id="end_date" name="end_date" class="form-control" value="{{ end_date }}">
    </div>
    <div class="col-auto align-self-end">
        <button type="submit" class="btn btn-primary btn-smaller">Filter</button>
    </div>
</form>

{% for period in all_periods %}
<div class="card mb-2">
    <div class="card-header bg-info text-white">
        Period: {{ period.start_date }} → {{ period.end_date }}
        | Sales: {{ "{:,.2f}".format(period.total_sales) }}
        | Deposits: {{ "{:,.2f}".format(period.total_credits) }}
        | Diff: <span class="{{ 'diff-negative' if period.total_diff<0 else 'diff-positive' }}">
            {{ "{:,.2f}".format(period.total_diff) }}
          </span>
    </div>
    <div class="card-body p-0">
        <table class="table table-bordered table-sm mb-0">
            <thead class="table-light text-center">

                <!-- SECTION HEADERS -->
                <tr>
                    <th colspan="6" class="bg-secondary text-white">Cartões</th>
                    <th colspan="5" class="bg-secondary text-white">Dinheiro</th>
                </tr>

                <!-- COLUMN HEADERS -->
                <tr>
                    <!-- CARTÕES -->
                    <th>Data</th>
                    <th>Dia</th>
                    <th class="text-end">Cartões</th>
                    <th class="text-end">POS Vendas</th>
                    <th class="text-end">Diferença</th>
                    <th class="text-end">Saldo</th>

                    <!-- DINHEIRO -->
                    <th class="text-end">Dinheiro</th>
                    <th class="text-end">Depósito</th>
                    <th class="text-end">Diferença</th>
                    <th class="text-end">Saldo</th>
                    <th>Dia</th>
                </tr>
            </thead>

            <tbody>
            {% for row in period.rows %}
                <tr {% if row.bank_deposit %}class="table-success"{% endif %}>

                    <!-- CARTÕES -->
                    <td>{{ row.date }}</td>
                    <td>{{ row.day_name }}</td>

                    <td class="text-end">
                        {{ "{:,.2f}".format(row.sales_card) }}
                    </td>

                    <td class="text-end">
                        {% if row.bank_pos %}
                            <a href="{{ url_for('bank_details', date=row.date) }}">
                                {{ "{:,.2f}".format(row.bank_pos) }}
                            </a>
                        {% endif %}
                    </td>

                    <td class="text-end {{ 'diff-negative' if row.diff_card < 0 else 'diff-positive' }}">
                        {{ "{:,.2f}".format(row.diff_card) }}
                    </td>

                    <td class="text-end fw-bold">
                        {% if row.card_balance is not none %}
                            {{ "{:,.2f}".format(row.card_balance) }}
                        {% endif %}
                    </td>


                    <!-- DINHEIRO -->
                    <td class="text-end bg-warning">
                        {{ "{:,.2f}".format(row.sales_cash) }}
                    </td>

                    <td class="text-end bg-warning">
                        {% if row.bank_deposit %}
                            {{ "{:,.2f}".format(row.bank_deposit) }}
                        {% endif %}
                    </td>

                    <td class="text-end
                        {% if row.diff_cash is not none %}
                            {{ 'diff-negative' if row.diff_cash < 0 else 'diff-positive' }}
                        {% endif %}
                    ">
                        {% if row.diff_cash is not none %}
                            {{ "{:,.2f}".format(row.diff_cash) }}
                        {% else %}
                            —
                        {% endif %}
                    </td>


                    <td class="text-end fw-bold">
                        {% if row.cash_balance is not none %}
                            {{ "{:,.2f}".format(row.cash_balance) }}
                        {% endif %}
                    </td>


                    <td>{{ row.day_name }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>


    </div>
</div>
{% endfor %}

</body>
</html>

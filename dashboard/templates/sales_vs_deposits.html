<!DOCTYPE html>
<html>
<head>
    <title>Sales vs Bank Deposits</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-size: 0.9rem; }
        table { font-size: 0.85rem; margin-bottom: 1rem; }
        th, td { padding: 0.3rem 0.5rem; vertical-align: middle; }
        .text-end { text-align: right; }
        .diff-negative { color: red; font-weight: bold; }
        .diff-positive { color: green; font-weight: bold; }
        .card-header { font-size: 0.9rem; padding: 0.35rem 0.75rem; }
        .btn-smaller { font-size: 0.8rem; padding: 0.25rem 0.5rem; }
    </style>
</head>
<body class="container mt-4">

<!-- Back button -->
<a href="{{ url_for('dashboard') }}" class="btn btn-secondary btn-smaller mb-3">← Back to Dashboard</a>

<!-- Date selection form -->
<form method="get" class="row g-3 mb-4">
    <div class="col-auto">
        <label for="start_date" class="form-label">Start:</label>
        <input type="date" id="start_date" name="start_date" class="form-control" value="{{ start_date }}">
    </div>
    <div class="col-auto">
        <label for="end_date" class="form-label">End:</label>
        <input type="date" id="end_date" name="end_date" class="form-control" value="{{ end_date }}">
    </div>
    <div class="col-auto align-self-end">
        <button type="submit" class="btn btn-primary btn-smaller">Filter</button>
    </div>
</form>

{% for period in all_periods %}
<div class="card mb-2">
    <div class="card-header bg-info text-white">
        Period: {{ period.start_date }} → {{ period.end_date }}
        | Sales: {{ "{:,.2f}".format(period.total_sales) }}
        | Deposits: {{ "{:,.2f}".format(period.total_credits) }}
        | Diff: <span class="{{ 'diff-negative' if period.total_diff<0 else 'diff-positive' }}">
            {{ "{:,.2f}".format(period.total_diff) }}
          </span>
    </div>
    <div class="card-body p-0">
        <table class="table table-bordered mb-0 table-sm">
            <thead class="table-light">
                <tr>
                    <th>Date</th>
                    <th class="text-end">Sales</th>
                    <th class="text-end">Bank</th>
                    <th class="text-end">Diff</th>
                    <th class="text-end">Accum</th>
                </tr>
            </thead>
            <tbody>
            {% for row in period.rows %}
                <tr>
                    <td>{{ row.date.date() }}</td>
                    <td class="text-end">{{ "{:,.2f}".format(row.sales_amount) }}</td>
                    <td class="text-end">
                        {% if row.credit_amount > 0 %}
                        <a href="{{ url_for('bank_details', date=row.date.strftime('%Y-%m-%d'), start_period=period.start_date, end_period=period.end_date) }}">
                            {{ "{:,.2f}".format(row.credit_amount) }}
                        </a>
                        {% else %}
                            {{ "{:,.2f}".format(row.credit_amount) }}
                        {% endif %}
                    </td>
                    <td class="text-end {{ 'diff-negative' if row.difference<0 else 'diff-positive' }}">
                        {{ "{:,.2f}".format(row.difference) }}
                    </td>
                    <td class="text-end">{{ "{:,.2f}".format(row.accumulated) }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endfor %}

</body>
</html>
